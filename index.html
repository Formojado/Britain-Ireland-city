<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UK & Ireland City Speedrun - Survival Mode</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html,body{height:100%;margin:0;font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif;background:#0f1724;color:#e6eef8;overflow:hidden;}
    #map{height:100vh;width:100vw;position:relative;z-index: 1;}

    /* Start Screen */
    .overlay-start{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(15, 23, 42, 0.95);z-index:1000;}
    .start-box{background:#fff;color:#04263b;padding:40px;border-radius:24px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.6);max-width:450px; line-height: 1.6;}
    .start-box h2{margin:0 0 15px 0; color:#1e293b; font-size: 2rem;}
    
    /* Info Bar */
    .info-bar{position:absolute;top:15px;left:50%;transform:translateX(-50%);background:rgba(15, 23, 42, 0.9);padding:12px 30px;border-radius:18px;display:flex;gap:30px;z-index:900;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.15);box-shadow:0 8px 32px rgba(0,0,0,0.5);}
    .info-item{display:flex;flex-direction:column;align-items:center; min-width: 70px;}
    .info-label{font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;opacity:0.6;margin-bottom:4px;}
    .info-value{font-size:1.3rem;font-weight:800; font-variant-numeric: tabular-nums;}

    /* Status Colors */
    .status-alive{color: #10b981; text-shadow: 0 0 12px rgba(16,185,129,0.7);}
    .status-dead{color: #ef4444; text-shadow: 0 0 12px rgba(239,68,68,0.7); animation: blink 0.8s infinite;}

    /* City Target Title */
    .city-title{position:absolute;top:120px;left:50%;transform:translateX(-50%);z-index:1001;font-size:2.8rem;font-weight:900;color:#fff;text-shadow:0 0 20px rgba(0,0,0,1), 4px 4px 0px #3b82f6;pointer-events:none;text-align:center;width:100%;}

    .btn{background:#3b82f6;color:#fff;border:none;padding:16px 32px;border-radius:14px;font-weight:700;cursor:pointer;font-size:1.1rem;transition:0.2s; margin-top: 15px;}
    .btn:hover{background:#2563eb; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);}

    /* End Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.92);display:flex;align-items:center;justify-content:center;z-index:2000;backdrop-filter:blur(12px);}
    .modal{background:#fff;color:#04263b;padding:45px;border-radius:28px;width:380px;text-align:center;box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);}
    
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="info-bar">
    <div class="info-item"><span class="info-label">Time</span><span id="time" class="info-value">00:00</span></div>
    <div class="info-item"><span class="info-label">Progress</span><span class="info-value"><span id="progress">0</span>/50</span></div>
    <div class="info-item"><span class="info-label">Score</span><span id="score" class="info-value">0</span></div>
    <div class="info-item" id="statusBox" style="display:none;"><span class="info-label">Status</span><span id="aliveStatus" class="info-value status-alive">ALIVE</span></div>
  </div>

  <div id="overlayStart" class="overlay-start">
    <div class="start-box">
      <h2>UK & Ireland Speedrun</h2>
      <p><b>Survival Rules:</b><br>Your click must be within 10km of the target.<br>If you miss, you are "OUT", but the game continues for practice until all 50 cities are completed.</p>
      <button id="startBtn" class="btn">Start Run</button>
    </div>
  </div>

  <div class="city-title" id="cityTitle" style="display:none"></div>

  <div id="endModal" style="display:none" class="modal-backdrop">
    <div class="modal">
      <h2 id="resultTitle" style="font-size: 2rem; margin-bottom: 10px;">Game Over</h2>
      <div id="stats" style="font-size:1.2rem; margin: 25px 0; color: #475569; line-height: 1.5;"></div>
      <button id="playAgainBtn" class="btn">Try Again</button>
    </div>
  </div>

  <script>
    const ALL_CITIES = [
        {name:"London",coords:[51.5074,-0.1278]},{name:"Manchester",coords:[53.4808,-2.2426]},{name:"Birmingham",coords:[52.4862,-1.8904]},{name:"Glasgow",coords:[55.8642,-4.2518]},{name:"Liverpool",coords:[53.4084,-2.9916]},{name:"Edinburgh",coords:[55.9533,-3.1883]},{name:"Leeds",coords:[53.8008,-1.5491]},{name:"Sheffield",coords:[53.3811,-1.4701]},{name:"Bristol",coords:[51.4545,-2.5879]},{name:"Belfast",coords:[54.5973,-5.9301]},{name:"Dublin",coords:[53.3498,-6.2603]},{name:"Leicester",coords:[52.6369,-1.1398]},{name:"Coventry",coords:[52.4068,-1.5197]},{name:"Hull",coords:[53.7443,-0.3325]},{name:"Cardiff",coords:[51.4816,-3.1791]},{name:"Bradford",coords:[53.7938,-1.7564]},{name:"Newcastle",coords:[54.9783,-1.6178]},{name:"Nottingham",coords:[52.9548,-1.1581]},{name:"Southampton",coords:[50.9097,-1.4044]},{name:"Portsmouth",coords:[50.8198,-1.088]},{name:"Plymouth",coords:[50.3755,-4.1427]},{name:"Derby",coords:[52.9225,-1.4746]},{name:"Reading",coords:[51.4543,-0.9722]},{name:"Stoke-on-Trent",coords:[53.0027,-2.1794]},{name:"Wolverhampton",coords:[52.5862,-2.1288]},{name:"Swansea",coords:[51.6214,-3.9436]},{name:"Oxford",coords:[51.752,-1.2577]},{name:"Cambridge",coords:[52.2053,0.1218]},{name:"Norwich",coords:[52.6309,1.2974]},{name:"Aberdeen",coords:[57.1497,-2.0943]},{name:"Inverness",coords:[57.4778,-4.2247]},{name:"Cork",coords:[51.8985,-8.4756]},{name:"Limerick",coords:[52.6638,-8.6268]},{name:"Galway",coords:[53.2707,-9.0568]},{name:"Brighton",coords:[50.8225,-0.1372]},{name:"Exeter",coords:[50.726,-3.5275]},{name:"Gloucester",coords:[51.8642,-2.2467]},{name:"York",coords:[53.9591,-1.0812]},{name:"Blackpool",coords:[53.8175,-3.0357]},{name:"Dundee",coords:[56.462,-2.9707]},{name:"Londonderry",coords:[54.9966,-7.3074]},{name:"Milton Keynes",coords:[52.0406,-0.7594]},{name:"Northampton",coords:[52.2405,-0.9027]},{name:"Preston",coords:[53.7632,-2.7031]},{name:"Sunderland",coords:[54.9069,-1.3838]},{name:"Ipswich",coords:[52.0567,1.1482]},{name:"Bournemouth",coords:[50.7192,-1.8808]},{name:"Middlesbrough",coords:[54.5762,-1.2348]},{name:"Peterborough",coords:[52.5739,-0.2477]},{name:"Colchester",coords:[51.8917,0.903] }
    ];

    let cities=[], index=0, started=false, answered=false, markers=[], circles=[], score=0, startTime=null, timerInterval=null;
    let isGameOver = false, deathCity = "", currentCityMarker = null;

    const map = L.map('map', {zoomControl:false}).setView([54.5, -4], 6);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const timeEl=document.getElementById('time'), progressEl=document.getElementById('progress');
    const scoreEl=document.getElementById('score'), aliveStatusEl=document.getElementById('aliveStatus');
    const cityTitle=document.getElementById('cityTitle'), endModal=document.getElementById('endModal');

    function haversine(a,b){
      const R=6371;
      const dLat=(b[0]-a[0])*Math.PI/180, dLon=(b[1]-a[1])*Math.PI/180;
      const aa=Math.sin(dLat/2)**2 + Math.cos(a[0]*Math.PI/180)*Math.cos(b[0]*Math.PI/180)*Math.sin(dLon/2)**2;
      return R*2*Math.atan2(Math.sqrt(aa),Math.sqrt(1-aa));
    }

    function resetGame(){
      cities = [...ALL_CITIES].sort(() => Math.random() - 0.5).slice(0, 50);
      index=0; score=0; started=false; isGameOver=false; deathCity="";
      clearMapObjects();
      progressEl.textContent="0"; scoreEl.textContent="0"; timeEl.textContent="00:00";
      aliveStatusEl.textContent="ALIVE"; aliveStatusEl.className="info-value status-alive";
      document.getElementById('statusBox').style.display='none';
      if(timerInterval) clearInterval(timerInterval);
      document.getElementById('overlayStart').style.display='flex';
      endModal.style.display='none';
      cityTitle.style.display='none';
      map.setView([54.5, -4], 6);
    }

    function startGame(){
      document.getElementById('overlayStart').style.display='none';
      document.getElementById('statusBox').style.display='flex';
      started=true; startTime=Date.now();
      timerInterval=setInterval(()=>{
        const diff=Date.now()-startTime;
        timeEl.textContent=`${String(Math.floor(diff/60000)).padStart(2,'0')}:${String(Math.floor((diff%60000)/1000)).padStart(2,'0')}`;
      },1000);
      showNextCity();
    }

    function showNextCity(){
      answered=false;
      progressEl.textContent=index+1;
      cityTitle.textContent = cities[index].name;
      cityTitle.style.display='block';
      map.flyTo([54.5, -4], 6, {duration: 0.8, easeLinearity: 0.5});
    }

    map.on('click', function(e){
      if(!started || answered) return;
      answered=true;
      const city=cities[index], clickCoords=[e.latlng.lat, e.latlng.lng];
      const dist=haversine(clickCoords, city.coords);
      
      markers.push(L.circleMarker(clickCoords, {radius:8, color:'#3b82f6', fillOpacity:1}).addTo(map));
      circles.push(L.circle(city.coords, {radius: 10000, color: '#10b981', weight: 3, fillOpacity: 0.2}).addTo(map));
      currentCityMarker = L.marker(city.coords).addTo(map).bindPopup(`<b>${city.name}</b><br>${dist.toFixed(1)} km`).openPopup();

      if(dist <= 10) {
        score += Math.max(10, Math.round(100 - dist * 5));
        scoreEl.textContent = score;
      } else if(!isGameOver) {
        isGameOver=true; deathCity=city.name;
        aliveStatusEl.textContent="OUT";
        aliveStatusEl.className="info-value status-dead";
      }

      map.flyTo(city.coords, 9, {duration: 0.6});
      
      // Handle logic for next step or end
      setTimeout(()=>{
        clearMapObjects();
        index++;
        if(index < 50) {
            showNextCity();
        } else {
            endGame();
        }
      }, 1800);
    });

    function clearMapObjects(){
      markers.forEach(m=>map.removeLayer(m)); markers=[];
      circles.forEach(c=>map.removeLayer(c)); circles=[];
      if(currentCityMarker) { map.removeLayer(currentCityMarker); currentCityMarker=null; }
    }

    function endGame(){
      started=false;
      clearInterval(timerInterval);
      cityTitle.style.display='none';
      
      const stats = document.getElementById('stats');
      const resultTitle = document.getElementById('resultTitle');

      if(isGameOver) {
        resultTitle.textContent = "Eliminated!";
        resultTitle.style.color = "#ef4444";
        stats.innerHTML = `You failed at <b>${deathCity}</b>.<br><br>Final Score: <b>${score}</b><br>Total Time: <b>${timeEl.textContent}</b>`;
      } else {
        resultTitle.textContent = "Survivor!";
        resultTitle.style.color = "#10b981";
        stats.innerHTML = `You completed all 50 cities!<br><br>Final Score: <b>${score}</b><br>Total Time: <b>${timeEl.textContent}</b>`;
      }
      
      endModal.style.display='flex';
    }

    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('playAgainBtn').addEventListener('click', resetGame);
    resetGame();
  </script>
</body>
</html>
